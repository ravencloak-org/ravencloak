# Auth Backend - Release (Tag: v*)
when:
  - event: tag
    ref: refs/tags/v*

steps:
  - name: build
    image: eclipse-temurin:21-jdk
    commands:
      - export VERSION=${CI_COMMIT_TAG#v}
      - echo "Building Auth Backend version $VERSION"
      - ./gradlew bootJar -Pversion=$VERSION --no-daemon --build-cache
    volumes:
      - /opt/woodpecker-cache/gradle:/root/.gradle

  - name: github-release
    image: woodpeckerci/plugin-release
    settings:
      files:
        - build/libs/*.jar
      title: "Auth Backend ${CI_COMMIT_TAG}"
      note: "KOS Auth Backend Release ${CI_COMMIT_TAG}"
      api_key:
        from_secret: github_token
