services:
  auth-backend:
    image: ghcr.io/ravencloak-org/ravencloak:latest
    container_name: auth-backend
    ports:
      - "8091:8080"
    environment:
      # Production database (update these with your actual values)
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT:-5432}
      - DB_NAME=${DB_NAME:-kos-auth}
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      # Production Keycloak
      - KEYCLOAK_BASE_URL=${KEYCLOAK_BASE_URL:-https://auth.keeplearningos.com}
      - KEYCLOAK_ISSUER_PREFIX=${KEYCLOAK_ISSUER_PREFIX:-https://auth.keeplearningos.com/realms/}
      - KEYCLOAK_SAAS_ISSUER_URI=${KEYCLOAK_SAAS_ISSUER_URI:-https://auth.keeplearningos.com/realms/saas-admin}
      - SAAS_ADMIN_CLIENT_SECRET=${SAAS_ADMIN_CLIENT_SECRET}
      # Server configuration for reverse proxy
      - SERVER_FORWARD_HEADERS_STRATEGY=framework
      - SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_SAAS_ADMIN_REDIRECT_URI=https://api.ravencloak.org/login/oauth2/code/saas-admin
      # Disable OTEL for now
      - OTEL_SDK_DISABLED=true
    restart: unless-stopped

  auth-frontend:
    image: ghcr.io/ravencloak-org/ravencloak-web:latest
    container_name: auth-frontend
    ports:
      - "8090:80"
    restart: unless-stopped
